<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redirecting...</title>
  <link rel="stylesheet" href="/kimhubfx/style.css" />
</head>
<body>
  <main class="center">
    <h3>Completing login…</h3>
    <p>Please wait — redirecting to dashboard.</p>
  </main>

<script>
(function() {
  // support token in fragment (#token=...) or query (?token=...)
  function tokenFromHash() {
    const h = window.location.hash || '';
    if (!h) return null;
    const frag = h.startsWith('#') ? h.slice(1) : h;
    const parts = frag.split('&');
    for (const p of parts) {
      const [k,v] = p.split('=');
      if (!k || !v) continue;
      if (k === 'token' || k === 'access_token') return decodeURIComponent(v);
    }
    return null;
  }
  function tokenFromQuery() {
    const q = new URLSearchParams(window.location.search);
    return q.get('token') || q.get('access_token') || null;
  }

  const token = tokenFromHash() || tokenFromQuery();
  if (!token) {
    // no token — go back to login
    window.location.href = '/kimhubfx/login.html';
    return;
  }

  // store token and redirect to dashboard (clean URL)
  localStorage.setItem('auth_token', token);
  // remove fragment/query from history and go to dashboard
  window.history.replaceState({}, document.title, '/kimhubfx/dashboard.html');
  window.location.href = '/kimhubfx/dashboard.html';
})();
</script>
</body>
</html>