<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Analysis Tool • KIMHUBFX</title>
<link rel="stylesheet" href="style.css">
<style>
/* Minimal styling to match your theme */
.analysis-wrap { padding: 15px; }
.price-box { font-size: 22px; font-weight: 800; margin-bottom: 15px; }
.digit-grid { 
  display: grid; 
  grid-template-columns: repeat(5,1fr); 
  gap: 12px; 
}
.digit-cell { text-align:center; padding:10px; background:#111; border-radius:10px; }
.digit-circle {
  width:60px; height:60px;
  border-radius:50%;
  background:#000;
  display:flex; align-items:center; justify-content:center;
  font-size:22px; font-weight:900;
  margin:0 auto; color:white;
}
.digit-circle.high { box-shadow:0 0 12px #16a34a; }
.digit-circle.low { box-shadow:0 0 12px #ff4d4d; }

.digit-pct { margin-top:6px; font-weight:700; color:#ffbf00; }

.stream { margin-top:15px; display:flex; flex-wrap:wrap; gap:8px; }
.stream span {
  padding:6px 9px;
  border-radius:6px;
  font-weight:800;
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div id="sidebar" class="sidebar">
  <div class="side-inner">
    <h2>KIMHUBFX</h2>

    <div class="section-title">Account</div>
    <a href="#">Account Settings</a>
    <a href="#">Cashier</a>
    <a href="#">Dark Theme</a>

    <div class="section-title">Channels</div>
    <a href="https://wa.me/254724753475" target="_blank">WhatsApp DM</a>
    <a href="https://whatsapp.com/channel/0029Vb77BD8B4hdNphlldH3g" target="_blank">WhatsApp Channel</a>
    <a href="https://www.youtube.com/@kimhtai" target="_blank">YouTube</a>
    <a href="https://www.tiktok.com/@kimh.tai" target="_blank">TikTok</a>
    <a href="https://t.me/kimhubfx" target="_blank">Telegram</a>
    <a href="https://www.instagram.com/kimh.tai" target="_blank">Instagram</a>
    <a href="https://www.facebook.com/profile.php?id=61582999149557" target="_blank">Facebook</a>

  </div>
</div>

<!-- TOP BAR -->
<header class="topbar">
  <div class="left">
    <button class="icon-btn" onclick="appUI.openMenu()">☰</button>
    <span class="logo">KIMHUBFX</span>
  </div>
  <div id="authContainer" class="auth-buttons"></div>
</header>

<!-- HORIZONTAL MENU -->
<nav class="horizontal-menu">
  <div onclick="location.href='dashboard.html'">Dashboard</div>
  <div onclick="location.href='bot-builder.html'">Bot Builder</div>
  <div onclick="location.href='freebots.html'">FreeBots</div>
  <div class="active">Analysis Tool</div>
  <div onclick="location.href='analysis.html'">Analysis</div>
  <div onclick="location.href='dp-tool.html'">DP Tool</div>
  <div onclick="location.href='dtrader.html'">DTrader</div>
  <div onclick="location.href='wallet.html'">Wallet</div>
</nav>

<!-- MAIN CONTENT -->
<main class="container">
  <div class="analysis-wrap">

    <div class="price-box">
      Price: <span id="price">—</span>
    </div>

    <!-- DIGIT GRID -->
    <div id="digitGrid" class="digit-grid">
      <!-- JS fills this -->
    </div>

    <!-- DIGIT STREAM -->
    <div class="stream" id="stream"></div>

  </div>
</main>

<script src="menu.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  appUI.renderAuthButtons("authContainer");
  startDigits();
});

function startDigits(){
  const APP_ID = 1089;
  let ws = new WebSocket("wss://ws.derivws.com/websockets/v3?app_id=" + APP_ID);

  let digits = [];
  let count = Array(10).fill(0);
  const maxTicks = 1000;

  const priceEl = document.getElementById("price");
  const digitGrid = document.getElementById("digitGrid");
  const stream = document.getElementById("stream");

  // build grid
  for(let i=0;i<10;i++){
    digitGrid.innerHTML += `
      <div class="digit-cell">
        <div class="digit-circle" id="d${i}">${i}</div>
        <div class="digit-pct" id="p${i}">0%</div>
      </div>
    `;
  }

  ws.onopen = () => {
    ws.send(JSON.stringify({ticks:"R_100", subscribe:1}));
  };

  ws.onmessage = (e) => {
    let data = JSON.parse(e.data);
    if(!data.tick) return;

    let price = data.tick.quote;
    priceEl.textContent = price;

    let s = String(price);
    let last = Number(s[s.length-1]);

    // update stats
    digits.push(last);
    count[last]++;

    if(digits.length > maxTicks){
      let removed = digits.shift();
      count[removed]--;
    }

    updateDigits(count, digits);
  };

  function updateDigits(count, digits){
    let total = digits.length || 1;

    let max = Math.max(...count);
    let min = Math.min(...count);

    for(let i=0;i<10;i++){
      let pct = (count[i]/total)*100;
      document.getElementById("p"+i).textContent = pct.toFixed(2)+"%";

      let circle = document.getElementById("d"+i);
      circle.classList.remove("high","low");
      if(count[i] === max) circle.classList.add("high");
      if(count[i] === min) circle.classList.add("low");
    }

    // digit stream (last 12)
    stream.innerHTML = "";
    digits.slice(-12).reverse().forEach(d=>{
      let box = document.createElement("span");
      box.textContent = d;
      stream.appendChild(box);
    });
  }
}
</script>

</body>
</html>