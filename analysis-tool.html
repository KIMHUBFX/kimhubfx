<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KIMHUBFX • Analysis Tool</title>

  <!-- use your existing style.css -->
  <link rel="stylesheet" href="style.css" />

  <style>
    /* small, page-specific UI helpers (won't conflict with your full CSS) */
    .card { background:#fff;border-radius:12px;padding:16px;margin:12px 12px;box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    .controls { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:12px; }
    .select, .input, .btn { padding:10px 12px; border-radius:8px; border:1px solid #ddd; background:#fff; }
    .btn { cursor:pointer; background:#ff4d4d; color:#fff; border:none; }
    .status { font-weight:700; margin-left:8px; }
    .digit-grid { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .digit-pill { width:56px; height:56px; border-radius:28px; display:flex;align-items:center;justify-content:center;flex-direction:column;background:#111;color:#fff;font-weight:700; }
    .pill-percent { font-size:12px; opacity:.9; margin-top:4px; }
    .bar { height:12px; background:#eee;border-radius:8px;margin-top:8px; overflow:hidden; }
    .bar-fill { height:100%; background:#4caf50; width:0%; transition:width .3s ease; }
    .muted { color:#777; font-size:14px; }
    .row { display:flex; gap:12px; align-items:center; }
    .left { flex:1; }
    .right { min-width:160px; text-align:right; }
  </style>
</head>
<body>

  <!-- top menu -->
  <div style="padding:12px;background:#ff4d4d;color:#fff;font-weight:700;display:flex;justify-content:space-between;align-items:center;">
    <div>KIMHUBFX</div>
    <div>
      <button onclick="window.location.href='index.html'" style="background:transparent;color:#fff;border:1px solid rgba(255,255,255,.2);padding:8px 10px;border-radius:8px;">Home</button>
    </div>
  </div>

  <main style="max-width:960px;margin:16px auto;padding:0 8px;">

    <div class="card">
      <div class="row">
        <div class="left">
          <div style="font-weight:800">Analysis / Digit Distribution</div>
          <div class="muted">Live tick stream, last-digit distribution (0–9) and even/odd</div>
        </div>

        <div class="right">
          <span id="connStatus" class="status">Disconnected</span>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="controls">
        <select id="marketSelect" class="select">
          <!-- options will be added by JS -->
        </select>

        <input id="historyInput" class="input" style="width:90px" type="number" min="10" value="500" />
        <button id="connectBtn" class="btn">Connect</button>
        <button id="disconnectBtn" class="btn" style="background:#6c757d">Disconnect</button>

        <div style="margin-left:8px;" class="muted">Total ticks: <span id="totalTicks">0</span></div>
      </div>

      <div id="latestCard" style="display:flex;gap:12px;align-items:center;margin-top:12px;">
        <div style="flex:1">
          <div class="muted">Latest Price</div>
          <div id="latestPrice" style="font-size:20px;font-weight:700">—</div>
        </div>

        <div style="width:120px">
          <div class="muted">Last Digit</div>
          <div id="lastDigit" style="font-size:28px;font-weight:900">—</div>
        </div>
      </div>

    </div>

    <div class="card" id="distributionCard" style="margin-top:14px;">
      <div style="font-weight:800">Digits distribution (0–9)</div>
      <div class="digit-grid" id="digitGrid"></div>
    </div>

    <div class="card" style="margin-top:12px;">
      <div style="font-weight:800">Even / Odd</div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <div style="flex:1">
          <div class="muted">Even</div>
          <div class="bar"><div id="evenFill" class="bar-fill" style="background:#2ecc71"></div></div>
        </div>
        <div style="flex:1">
          <div class="muted">Odd</div>
          <div class="bar"><div id="oddFill" class="bar-fill" style="background:#ff6b6b"></div></div>
        </div>
      </div>
    </div>

  </main>

  <script src="menu.js"></script>
  <script src="market-engine.js"></script>
  <script>
    // init UI and wire to engine (marketEngine is defined in market-engine.js)
    const engine = window.marketEngine;

    const marketSelect = document.getElementById('marketSelect');
    const historyInput = document.getElementById('historyInput');
    const connectBtn = document.getElementById('connectBtn');
    const disconnectBtn = document.getElementById('disconnectBtn');
    const connStatus = document.getElementById('connStatus');
    const latestPrice = document.getElementById('latestPrice');
    const lastDigit = document.getElementById('lastDigit');
    const totalTicks = document.getElementById('totalTicks');
    const digitGrid = document.getElementById('digitGrid');
    const evenFill = document.getElementById('evenFill');
    const oddFill = document.getElementById('oddFill');

    // populate markets
    engine.getMarketList().forEach(m => {
      const o = document.createElement('option'); o.value = m.id; o.textContent = m.label; marketSelect.appendChild(o);
    });

    // build digit grid UI (0-9)
    function buildDigitUI(){
      digitGrid.innerHTML = '';
      for(let d=0; d<=9; d++){
        const pill = document.createElement('div');
        pill.className = 'digit-pill';
        pill.id = 'pill-'+d;
        pill.innerHTML = `<div style="font-size:18px">${d}</div><div class="pill-percent" id="p-${d}">0.00%</div>`;
        digitGrid.appendChild(pill);
      }
    }
    buildDigitUI();

    // UI update handler
    function refreshUI(){
      connStatus.textContent = engine.isConnected() ? 'Connected' : 'Disconnected';
      const stats = engine.getStats();
      latestPrice.textContent = stats.latestPrice ?? '—';
      lastDigit.textContent = (stats.lastDigit === null) ? '—' : stats.lastDigit;
      totalTicks.textContent = stats.totalTicks;

      // digits
      for(let d=0; d<=9; d++){
        const pct = stats.digitsPct[d] ?? 0;
        const el = document.getElementById('p-'+d);
        if(el) el.textContent = pct.toFixed(2) + '%';
        const pill = document.getElementById('pill-'+d);
        if(pill){
          // color intensity depend on pct
          const intensity = Math.min(1, pct/12); // cap
          pill.style.background = `rgba(${Math.round(200*(1-intensity))}, ${Math.round(200*(intensity))}, ${Math.round(80*(intensity))}, 1)`;
        }
      }

      // even/odd
      evenFill.style.width = stats.evenPct.toFixed(2) + '%';
      oddFill.style.width = stats.oddPct.toFixed(2) + '%';
    }

    // connect/disconnect buttons
    connectBtn.onclick = () => {
      const market = marketSelect.value;
      const historySize = parseInt(historyInput.value) || 500;
      engine.connect({market, historySize});
    };
    disconnectBtn.onclick = () => engine.disconnect();

    // engine events
    engine.on('connected', refreshUI);
    engine.on('disconnected', refreshUI);
    engine.on('tick', refreshUI);
    engine.on('stats', refreshUI);

    // periodic UI refresh (safe)
    setInterval(refreshUI, 800);

    // auto-select first market
    marketSelect.value = engine.getMarketList()[0].id;
  </script>
</body>
</html>
